<html>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.5.1/min/dropzone.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.5.1/min/dropzone.min.css" >


<!--node_modules/dropzone/dist/min/dropzone-amd-module.min.js-->


  <script type="text/javascript">






Dropzone.options.uploadForm = {
  autoProcessQueue: false,
  uploadMultiple: true,
  //paramName: "file", // The name that will be used to transfer the file
  maxFilesize: 1, // MB
  parallelUploads: 100,
  maxFiles: 100,
  //createImageThumbnails: false,
  acceptedFiles: "image/*",
  accept: function(file, done) {
    console.log("filename: " + file.name);
    if (file.name == "justinbieber.jpg") {
      done("Naha, you don't.");
    }
    else { done(); }
  },

  // The setting up of the dropzone
  init: function() {
    var dropzone = this;

    this.element.querySelector("button[type=submit]").addEventListener("click", function(e) {
      e.preventDefault();
      e.stopPropagation();

      dropzone.processQueue();
    });

    //this.on("sendingmultiple", function() {
      // Gets triggered when the form is actually being sent.
      // Hide the success button or the complete form.
    //});
    this.on("successmultiple", function(files, response) {
      var theImage = document.getElementById("output");
      theImage.setAttribute("src", response);
    });
    this.on("error", function(file, response) {
      alert(file.name + ": " + response);
    });
  }
};















    document.addEventListener("DOMContentLoaded", function(event) {

        //var theForm = document.getElementById("uploadform");



        var theForm = document.getElementById("upload-form");

        var onSubmit = (e) => {
          e.preventDefault();

          //theForm.processQueue();
          alert("yo");
          //this.processQueue();
          return;

          var url = theForm.getAttribute('action');
          console.log(url);
          var formData = new FormData(theForm);

          let i = 0;
          for(const fileList of droppedFileLists) {
            for(theFile of fileList) {
              i++;
              formData.append("file" + i, theFile);
            }
          }
          axios({
            method: "POST",
            url: url,
            data: formData,
          })
          .then(function(res) {
            var theImage = document.getElementById("output");
            theImage.setAttribute("src", res.data);

            // reset files to upload
            droppedFileLists = []
          })
          //.catch(function(e) {
          //  console.dir(e.response);
          //});
        };
        theForm.addEventListener("submit", onSubmit);
    });

    let droppedFileLists = [];

    function dropHandler(ev) {
      ev.preventDefault();

      if (ev.dataTransfer.items) {
        // Use DataTransferItemList interface to access the file(s)
        for (var i = 0; i < ev.dataTransfer.items.length; i++) {
          // ignore items that aren't files
          if (ev.dataTransfer.items[i].kind === 'file') {
            var file = ev.dataTransfer.items[i].getAsFile();
            console.log('... file[' + i + '].name = ' + file.name);
          }
        }
      } else {
        // Use DataTransfer interface to access the file(s)
        for (var i = 0; i < ev.dataTransfer.files.length; i++) {
          console.log('... file[' + i + '].name = ' + ev.dataTransfer.files[i].name);
        }
      }

      // dropping one or multiple files creates one new FileList
      // to append all files to form, store in droppedFileLists for later
      droppedFileLists.push(ev.dataTransfer.files);

      // Pass event to removeDragData for cleanup
      removeDragData(ev)
    }
    function dragOverHandler(ev) {
      // Prevent default behavior (Prevent file from being opened)
      ev.preventDefault();
    }
    function removeDragData(ev) {
      console.log('Removing drag data')

      if (ev.dataTransfer.items) {
        // Use DataTransferItemList interface to remove the drag data
        ev.dataTransfer.items.clear();
      } else {
        // Use DataTransfer interface to remove the drag data
        ev.dataTransfer.clearData();
      }
    }
  </script>

  <style>
    #drop_zone {
      border: 5px solid blue;
      width:  200px;
      height: 100px;
    }
  </style>

  <body>
    <form id='upload-form' action='http://localhost:3000/upload' method='post'
      class="dropzone"
      enctype="multipart/form-data">

      <!--<div id="drop_zone" ondrop="dropHandler(event);" ondragover="dragOverHandler(event);">-->
        <!--<p>Drag one or more files to this Drop Zone ...</p>-->
      <!--</div>-->

      <button type='submit' value='Upload!'>Combine images</button>
    </form>

    <br /><br /><br />

    <img id="output" src="" />
  </body>
</html>
