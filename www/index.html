<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Image Combiner - by Max IMBERT, Aug 2018</title>
  <script src="bower_components/dropzone/dist/min/dropzone.min.js"></script>

  <link rel="stylesheet" href="bower_components/dropzone/dist/min/dropzone.min.css" />
  <script type="text/javascript">
    Dropzone.options.uploadForm = {
      autoProcessQueue: false,
      uploadMultiple: true,
      addRemoveLinks: true,
      maxFilesize: 1, // MB
      parallelUploads: 100,
      maxFiles: 100,
      acceptedFiles: "image/*",
      init: function() {
        var dropzone = this;

        //var submitButton = this.element.querySelector("button[type=submit]");
        var submitButton = document.getElementById("combine");
        submitButton.addEventListener("click", function(e) {
          e.preventDefault();
          e.stopPropagation();

          dropzone.processQueue();
        });

        this.on("successmultiple", function(files, response) {
          // display the combined image in a dataURI (base64)
          var theImage = document.getElementById("outputImage");
          theImage.setAttribute("src", response);

          // setup download link
          var downloadLink = document.getElementById("downloadLink");
          downloadLink.setAttribute("href", response);

          dropzone.removeAllFiles();
        });
        this.on("error", function(file, response) {
          alert(file.name + ": " + response);
        });
      }
    };
  </script>

  <style>
    form label { display:block; text-align: center; }
    form { margin-top: 3em;}
    #results { display: none; }
    form { position:relative; }
    #buttons { position: absolute; bottom: 0;}
    #buttons button { display:inline-block; font-size: 1.33em; margin: 0 auto; }
    form button[type=submit] {}
    .dz-progress { display:none; }
  </style>
  </head>
  <body>
    <form id='upload-form' action='/upload' method='post' class="dropzone" 
      enctype="multipart/form-data">
      <label class="dz-message">Drop images here</label>
      <div id="buttons">
        <button type="submit" id="combine">Combine</button>
      </div>
    </form>
    <div id="result">
      <img id="outputImage" src="" />
      <a id="downloadLink" download="combined-image.png" href="">Download image</a>
    </div>
  </body>
</html>
