<html>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function(event) {
        var theForm = document.getElementById("uploadForm");
        var onSubmit = (e) => {
          e.preventDefault();

          var url = theForm.getAttribute('action');
          console.log(url);
          var formData = new FormData(theForm);
/*
          let i = 0;
          //console.dir(droppedFiles);
          for(theFile of droppedFiles) {
            i++;
            //console.log("i = " + i);
            //console.log("data" in theFile);
            //console.log(theFile);
            formData.append("file" + i, theFile);
          }
          //console.dir(formData.values());

          //for (let value of formData.values()) { console.dir(value); }
          //return

          */


          let i = 0;
          for(const fileList of dropppedFileLists) {
            for(theFile of fileList) {
              i++;
              formData.append("file" + i, theFile);
            }
          }


          axios({
            method: "POST",

            //content-type: "multipart/form-data",
            url: url,
            data: formData,
            //headers: { accept: "image/png" }
          })
          .then(function(res) {
            //console.dir(res.data);
            var theImage = document.getElementById("output");
            theImage.setAttribute("src", res.data);
            //theForm.attr("src","data:image/gif;base64," + rawImageData);

            // reset files to upload
            droppedFiles = []; 
          })
          .catch(function(e) {
            console.dir(e.response);
            alert(e.response.data);
          });
        };
        theForm.addEventListener("submit", onSubmit);
    });

  //droppedFiles = e.originalEvent.dataTransfer.files; // the files that were dropped
//<input type="file" id="fileElem" multiple accept="image/*" style="display:none" onchange="handleFiles(this.files)">
    let droppedFiles = [];
    const dropppedFileLists = [];

    function dropHandler(ev) {
      //console.log('File(s) dropped');
      ev.preventDefault();

      if (ev.dataTransfer.items) {
        // Use DataTransferItemList interface to access the file(s)
        for (var i = 0; i < ev.dataTransfer.items.length; i++) {
          // ignore items that aren't files
          if (ev.dataTransfer.items[i].kind === 'file') {
            var file = ev.dataTransfer.items[i].getAsFile();
            console.log('... file[' + i + '].name = ' + file.name);
          }
        }
      } else {
        // Use DataTransfer interface to access the file(s)
        for (var i = 0; i < ev.dataTransfer.files.length; i++) {
          console.log('... file[' + i + '].name = ' + ev.dataTransfer.files[i].name);
        }
      }

      droppedFiles = ev.dataTransfer.files;
      dropppedFileLists.push(ev.dataTransfer.files);
      //droppedFiles = droppedFiles.concat(ev.dataTransfer.files);

      console.log("droppedFiles");
      console.dir(droppedFiles);

      // Pass event to removeDragData for cleanup
      removeDragData(ev)
    }
    function dragOverHandler(ev) {
      console.log('File(s) in drop zone');

      // Prevent default behavior (Prevent file from being opened)
      ev.preventDefault();
    }
    function removeDragData(ev) {
      console.log('Removing drag data')

      if (ev.dataTransfer.items) {
        // Use DataTransferItemList interface to remove the drag data
        ev.dataTransfer.items.clear();
      } else {
        // Use DataTransfer interface to remove the drag data
        ev.dataTransfer.clearData();
      }
    }
  </script>

<style>
#drop_zone {
  border: 5px solid blue;
  width:  200px;
  height: 100px;
}
</style>

  <body>
    <form id='uploadForm' action='http://localhost:3000/upload' method='post'
      enctype="multipart/form-data">
        <!--<input type="file" name="file1" required /> <br />-->
        <!--<input type="file" name="file2" required /> <br />-->
        <!--<input type="file" name="file3" /> <br />-->
        <!--<input type="file" name="file4" /> <br />-->


        <br /><br /><br />
        <!--<input type="file" name="file5" multiple />-->
<div id="drop_zone" ondrop="dropHandler(event);" ondragover="dragOverHandler(event);">
  <p>Drag one or more files to this Drop Zone ...</p>
</div>

        <input type='submit' value='Upload!' />
    </form>

    <br /><br /><br />





    <img id="output" src="" />
  </body>
</html>
